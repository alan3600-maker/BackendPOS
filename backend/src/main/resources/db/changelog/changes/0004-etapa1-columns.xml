<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
  xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="
    http://www.liquibase.org/xml/ns/dbchangelog
     https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.29.xsd">

  <!-- Asegura columna version para optimistic locking (Stock) -->
  <changeSet id="0004-001-stock-version" author="hidraulica">
    <preConditions onFail="MARK_RAN">
      <and>
        <tableExists tableName="stock"/>
        <not>
          <columnExists tableName="stock" columnName="version"/>
        </not>
      </and>
    </preConditions>

    <addColumn tableName="stock">
      <column name="version" type="bigint" defaultValueNumeric="0">
        <constraints nullable="false"/>
      </column>
    </addColumn>
  </changeSet>

  <!-- Asegura activo en producto -->
  <changeSet id="0004-002-activo-producto" author="hidraulica">
    <preConditions onFail="MARK_RAN">
      <and>
        <tableExists tableName="producto"/>
        <not>
          <columnExists tableName="producto" columnName="activo"/>
        </not>
      </and>
    </preConditions>

    <addColumn tableName="producto">
      <column name="activo" type="boolean" defaultValueBoolean="true">
        <constraints nullable="false"/>
      </column>
    </addColumn>
  </changeSet>

  <!-- Asegura activo en cliente -->
  <changeSet id="0004-003-activo-cliente" author="hidraulica">
    <preConditions onFail="MARK_RAN">
      <and>
        <tableExists tableName="cliente"/>
        <not>
          <columnExists tableName="cliente" columnName="activo"/>
        </not>
      </and>
    </preConditions>

    <addColumn tableName="cliente">
      <column name="activo" type="boolean" defaultValueBoolean="true">
        <constraints nullable="false"/>
      </column>
    </addColumn>
  </changeSet>

</databaseChangeLog>
